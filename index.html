<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Recetas Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .preview-paper { aspect-ratio: 1 / 1.414; } /* Proporci√≥n A4 */
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-8">

    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
            <h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                <span>ü¶∑</span> Panel de Control
            </h2>
            
            <form id="recetaForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Nombre del Paciente</label>
                    <input type="text" id="inNombre" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-cyan-500 outline-none" placeholder="Ej. Juan P√©rez">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Edad</label>
                        <input type="text" id="inEdad" class="w-full p-2 border rounded-md outline-none" placeholder="25 a√±os">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Fecha</label>
                        <input type="date" id="inFecha" class="w-full p-2 border rounded-md outline-none">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Procedimiento</label>
                    <select id="inProcedimiento" class="w-full p-2 border rounded-md bg-white outline-none">
                        <option value="">Seleccionar...</option>
                        <option value="extraccion">Extracci√≥n Dental</option>
                        <option value="endodoncia">Endodoncia</option>
                        <option value="limpieza">Limpieza Profunda</option>
                        <option value="ortodoncia">Ajuste de Ortodoncia</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Indicaciones (RX)</label>
                    <textarea id="inIndicaciones" rows="6" class="w-full p-2 border rounded-md outline-none" placeholder="Escriba el tratamiento..."></textarea>
                </div>

                <button type="button" onclick="descargarPDF()" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 rounded-lg transition-all shadow-md flex justify-center items-center gap-2">
                    üìÑ Exportar a PDF
                </button>
            </form>
        </div>

        <div class="sticky top-8">
            <h2 class="text-sm font-semibold text-slate-500 uppercase tracking-widest mb-4">Vista Previa</h2>
            <div id="recetaPreview" class="preview-paper bg-white shadow-2xl rounded-sm p-8 flex flex-col relative overflow-hidden text-[10px] md:text-xs border">
                
                <div class="flex justify-between items-start border-b pb-4">
                    <div>
                        <h1 class="text-xl font-bold text-gray-800 uppercase leading-tight">Dr. Pedro Fern√°ndez</h1>
                        <p class="text-gray-600">M√©dico General <span class="mx-2">|</span> C.P. 132456789</p>
                    </div>
                    <div class="text-right text-[8px] text-gray-500">
                        <p>Cel. (316) 212-3456</p>
                        <p>Calle Cualquiera 123, Ciudad</p>
                        <p>hola@tusitio.com</p>
                    </div>
                </div>

                <div class="mt-6 grid grid-cols-3 gap-y-2 border-b pb-4">
                    <div class="col-span-2"><strong>Paciente:</strong> <span id="pvNombre" class="border-b border-dotted border-gray-400 min-w-[100px] inline-block"></span></div>
                    <div><strong>Edad:</strong> <span id="pvEdad" class="border-b border-dotted border-gray-400 inline-block w-full"></span></div>
                    <div class="col-span-3"><strong>Fecha:</strong> <span id="pvFecha" class="border-b border-dotted border-gray-400"></span></div>
                </div>

                <div class="mt-6 flex-grow">
                    <h3 class="font-bold text-lg mb-2">RX:</h3>
                    <div id="pvIndicaciones" class="whitespace-pre-line text-gray-700 leading-relaxed italic"></div>
                </div>

                <div class="absolute bottom-0 left-0 right-0 bg-[#e0f2f1] p-6 flex justify-between items-end">
                    <div class="text-[8px]">
                        <p class="font-bold">Horarios:</p>
                        <p>Lun - Vie: 10 a.m. a 5 p.m.</p>
                        <p class="mt-2 text-cyan-700">@unsitioestupendo</p>
                    </div>
                    <div class="text-right">
                        <div class="border-t border-gray-400 pt-1 px-4">
                            <p class="font-bold text-gray-800">Dr. Pedro Fern√°ndez</p>
                            <p>C.P. 132456789</p>
                        </div>
                    </div>
                    <div class="opacity-20 absolute right-4 bottom-12">
                        <svg class="w-16 h-16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L4.5 20.29L5.21 21L12 18L18.79 21L19.5 20.29L12 2Z"/></svg>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;

        // Base de datos de indicaciones
        const guias = {
            "extraccion": "INDICACIONES POST-EXTRACCI√ìN:\n1. Morder la gasa por 30 min.\n2. No realizar enjuagues ni escupir hoy.\n3. Aplicar hielo local intermitente.\n4. Dieta l√≠quida/blanda fr√≠a.",
            "endodoncia": "CUIDADOS ENDODONCIA:\n1. No masticar con el diente tratado hasta que tenga corona definitiva.\n2. Es normal dolor leve a la percusi√≥n por 3 d√≠as.\n3. Tomar el analg√©sico recetado.",
            "limpieza": "POST-LIMPIEZA:\n1. Posible sensibilidad al fr√≠o/calor por 48h.\n2. Evitar bebidas oscuras (caf√©, vino) por hoy.\n3. Usar hilo dental suavemente.",
            "ortodoncia": "AJUSTE BRACKETS:\n1. Cera dental en zonas de roce.\n2. Dieta blanda las primeras 24 horas.\n3. Enjuagues con agua tibia y sal si hay aftas."
        };

        const inputs = ['inNombre', 'inEdad', 'inFecha', 'inIndicaciones'];
        
        // Sincronizaci√≥n en tiempo real
        inputs.forEach(id => {
            document.getElementById(id).addEventListener('input', () => {
                const targetId = id.replace('in', 'pv');
                document.getElementById(targetId).innerText = document.getElementById(id).value;
            });
        });

        // Autocompletar por procedimiento
        document.getElementById('inProcedimiento').addEventListener('change', (e) => {
            const text = guias[e.target.value] || "";
            document.getElementById('inIndicaciones').value = text;
            document.getElementById('pvIndicaciones').innerText = text;
        });

        function descargarPDF() {
            const doc = new jsPDF();
            const nombre = document.getElementById('inNombre').value || "Paciente";
            
            // Recreamos el estilo de la plantilla en el PDF
            doc.setFont("helvetica", "bold");
            doc.setFontSize(22);
            doc.text("DR. PEDRO FERN√ÅNDEZ", 20, 30);
            
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.text("M√©dico General | C.P. 132456789", 20, 38);
            
            doc.text("Cel. (316) 212-3456", 150, 25, {align: "right"});
            doc.text("Calle Cualquiera 123", 150, 30, {align: "right"});

            doc.line(20, 45, 190, 45);

            doc.text(`Paciente: ${nombre}`, 20, 55);
            doc.text(`Edad: ${document.getElementById('inEdad').value}`, 120, 55);
            doc.text(`Fecha: ${document.getElementById('inFecha').value}`, 160, 55);

            doc.setFontSize(14);
            doc.setFont("helvetica", "bold");
            doc.text("RX:", 20, 75);
            
            doc.setFontSize(11);
            doc.setFont("helvetica", "italic");
            const splitTxt = doc.splitTextToSize(document.getElementById('inIndicaciones').value, 160);
            doc.text(splitTxt, 20, 85);

            // Pie de p√°gina color celeste
            doc.setFillColor(224, 242, 241);
            doc.rect(0, 260, 210, 40, 'F');
            doc.setFontSize(8);
            doc.setTextColor(50, 50, 50);
            doc.text("Horarios: L-V 10am-5pm", 20, 275);
            doc.text("Firma: ________________________", 140, 275);

            doc.save(`Receta_${nombre}.pdf`);
        }
    </script>
</body>
</html>